---
layout: default
---
# 语法规范 v0.2.1

## 概述

Altru 语言规范 v0.2.1 是一个面向未来的编程语言，旨在实现人机共用、团队协作开发，并为AI时代提供安全、高效、可验证的编程体验。

## 核心原则

- **安全性优先**: 编译期暴露所有潜在Bug
- **明确性**: 语法简洁但语义明确，无歧义  
- **可验证性**: 所有代码契约可在编译期验证
- **性能可控**: 提供细粒度的性能和内存控制
- **AI友好**: 为AI系统提供结构化、可理解的代码表示

## 主要特性概览

### 词法结构
- UTF-8 编码，支持 Unicode 标识符
- 关键字：`fn`, `let`, `const`, `if`, `else`, `while`, `for`, `match`, `trait`, `impl` 等
- 注释：`#` 单行注释，`##` 文档注释，`###` 多行注释
- 标签系统：`[ai_processing(...)]` 放在函数声明前一行

### 类型系统
- **基本类型**：`i8`, `i16`, `i32`, `i64`, `u8`, `u16`, `u32`, `u64`, `f32`, `f64`, `bool`, `char`, `string`
- **复合类型**：数组 `[T; N]`、动态数组 `vec[T]`、元组 `(T1, T2, ...)`、结构体、枚举、联合类型
- **泛型系统**：支持泛型函数、泛型结构体、类型约束 `where` 子句
- **Trait 系统**：接口契约，无继承仅组合，支持默认实现

### 语法特性
- **变量声明**：`let x = 42`（不可变，默认），`let mut y = 10`（可变）
- **函数定义**：强制契约标注 `req`（前置条件）和 `ens`（后置条件）
- **控制流**：`if/else`、`while`、`for` 循环、`match` 模式匹配
- **并发原语**：`go` 启动 goroutine，`chan` 通道，`select` 选择语句
- **模块系统**：`use` 导入，`mod` 模块定义，`pub` 公开标识

### 内存管理
- **所有权系统**：每个值有唯一所有者，赋值时转移所有权
- **借用规则**：任意数量不可变引用或恰好一个可变引用
- **生命周期**：`'a`, `'b` 等生命周期标注
- **手动分配**：`alloc()` 和 `free()` 函数

### AI集成特性
- **AI处理标注**：`[ai_processing(serialize="json", optimize="simd")]`
- **契约系统**：`req x > 0?` 编译为运行时检查
- **编译期验证**：自动验证函数契约、类型安全、内存安全
- **优化建议**：AI生成性能优化建议

### 运行时特性
- **动态函数替换**：`[hot_replaceable]` 标注支持热更新
- **AB测试支持**：`[ab_test(old_version="v1.0", new_version="v1.1")]`
- **日志系统**：`std::log` 模块，支持多级别、多输出

### 错误处理
- **Result类型**：`enum Result[T, E]: Ok(T), Err(E)`
- **错误传播**：`?` 操作符自动传播错误
- **异常安全**：无传统异常，使用 Result 类型进行错误处理

## 标准库概览

### 核心模块
- `std::core`：基础类型和操作
- `std::mem`：内存操作  
- `std::ptr`：指针操作
- `std::slice`：切片操作
- `std::log`：日志系统

### 数据结构
- `std::vec`：动态数组
- `std::map`：哈希映射
- `std::set`：集合
- `std::queue`：队列
- `std::channel`：通道实现

### 并发
- `std::thread`：线程管理
- `std::sync`：同步原语
- `std::stream`：数据流处理
- `std::async`：异步运行时

### I/O
- `std::io`：输入输出
- `std::fs`：文件系统
- `std::net`：网络操作

## 版本历史

- **0.0.1** (2026-02-10): 初始草案版本
- **0.1.0** (2026-02-10): 优化版本，包含16项改进  
- **0.2.0** (2026-02-10): 整合并发模型、模块系统、泛型系统、宏系统改进
- **0.2.1** (2026-02-10): 
  - 增加数组和元组使用范例
  - 简化函数和trait文档注释（只保留设计目的）
  - 标签系统改为函数声明前一行，逗号分隔
  - 补充运算符优先级
  - 添加super关键字用法示例